<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="com.easyLedger.mapper.easyLedgerMapper">
  
  	<select id="selectAll" resultType="board">
  		SELECT *
  		  FROM board
  	</select>
  
  	<insert id="registration" parameterType="board">
  		<selectKey keyProperty="bno" order="BEFORE" resultType="int">
			SELECT bno.NEXTVAL FROM DUAL
		</selectKey>
  		INSERT INTO board VALUES(
  					#{bno},
  					#{member_email:VARCHAR},
  					#{name:VARCHAR},
  					#{grade:VARCHAR},
  					#{paid:VARCHAR},
  					#{depositDate:VARCHAR},
  					#{paymentOption:VARCHAR},
  					#{memo:VARCHAR}
  					)
  	</insert> 

	<sql id="findWhere">
		<if test="findType != null and keyWord != ''">
		<where>
			<if test="findType==1">	
				(name like '%'||#{keyWord}||'%' or grade like '%'||#{keyWord}||'%'
				 or depositdate like '%'||#{keyWord}||'%' or paymentoption like '%'||#{keyWord}||'%'
				 or paid like '%'||#{keyWord}||'%' or memo like '%'||#{keyWord}||'%')
			</if>
			<if test="findType==2">
				name like '%'||#{keyWord}||'%'
			</if>
			<if test="findType==3">
				grade like '%'||#{keyWord}||'%'
			</if>
			<if test="findType==4">
				depositdate like '%'||#{keyWord}||'%'
			</if>
			<if test="findType==5">
				paymentoption like '%'||#{keyWord}||'%'
			</if>	
		</where>
		</if>
	</sql>
	
	<select id="selectPaging" parameterType="cri" resultType="board">
	SELECT  * 
	  FROM  (
	SELECT  ROWNUM rn, a. * 
	  FROM  ( 
	  		SELECT * FROM board 
	<include refid="findWhere"/>
		    ORDER BY bno desc ) a
	<![CDATA[
	 WHERE  member_email = #{email}
	   AND  ROWNUM < = #{pageNum} * #{amount}
			)
	 WHERE rn > (#{pageNum}-1) * #{amount}
	]]>
	</select>
	
	<select id="getTotalCount" parameterType="string" resultType="int">
	    SELECT  COUNT(member_email)
		  FROM  board 
		 WHERE  member_email = #{email:VARCHAR}
	</select>
	
	<select id="getBno" parameterType="string" resultType="board">
		SELECT  bno, name, grade, paid, depositdate, paymentoption, memo 
		  FROM  board
		 WHERE  bno = #{bno}
	</select>
	
	<update id="modify" parameterType="board">
		UPDATE  board
		   SET  name = #{name:VARCHAR},
		        grade = #{grade:VARCHAR},
		        paid = #{paid:VARCHAR},
		        depositDate = #{depositDate:VARCHAR},
				paymentOption = #{paymentOption:VARCHAR},
				memo = #{memo:VARCHAR}
		 WHERE  bno = #{bno:INTEGER}
	</update>
	
	<delete id="delete" parameterType="string">
		DELETE 
		  FROM  board 
		 WHERE  bno = #{bno}
	</delete>
	
	<insert id="memberRegist" parameterType="member">
		insert into member values(#{email:VARCHAR},#{pwd:VARCHAR},#{name:VARCHAR})
	</insert>
	
	<select id="emailCheck" parameterType="String" resultType="int">
		select count(email) from member where email=#{email}
	</select>
	
	<select id="finduserByemail" parameterType="String" resultType="member">
		select * from member where email=#{email}
	</select>
	
  </mapper> 